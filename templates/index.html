<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Vertical Video Maker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: "Segoe UI", sans-serif;
    }
    .form-control, .form-check-input {
      border-radius: 0.5rem;
      background-color: #2c2c2c;
      border: 1px solid #444;
      color: #fff;
    }
    .form-control::placeholder {
      color: #aaa;
    }
    .btn-primary {
      background-color: #5a5a5a;
      border: none;
    }
    .btn-primary:hover {
      background-color: #777;
    }
    .section-title {
      font-weight: 600;
      font-size: 1.3rem;
      margin-top: 2rem;
    }
    .ai-image-preview img {
      max-width: 100%;
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .form-check {
      margin-bottom: 1rem;
    }
    .btn-outline-secondary {
      border-color: #888;
      color: #ccc;
    }
    .btn-outline-secondary:hover {
      background-color: #333;
      color: #fff;
    }
  </style>
</head>
<body>

<div class="container py-4">
  <h1 class="text-center mb-4">Генератор видео для stories и reels</h1>

  <form id="video-form" method="POST" enctype="multipart/form-data">
    <div class="mb-4">
      <div class="section-title">Добавьте изображения:</div>
      <input class="form-control" type="file" name="images" multiple accept=".jpg,.png">
    </div>

    <div class="mb-4">
      <div class="section-title">Или добавьте видео (опц.):</div>
      <input class="form-control" type="file" name="video" accept=".mp4">
    </div>

    <div class="mb-4">
      <div class="section-title">Сгенерируйте изображения, если своих нет</div>
      <label class="form-label">Промпт 1:</label>
      <input class="form-control mb-2" type="text" id="prompt1" name="prompt1" placeholder="Например: завтрак на веранде">
      <label class="form-label">Промпт 2 (опц.):</label>
      <input class="form-control mb-2" type="text" id="prompt2" name="prompt2" placeholder="Например: чашка кофе на пляже">

      <button class="btn btn-outline-secondary mb-3" type="button" onclick="generateAIImages()">⚡ Сгенерировать изображения</button>

      <div id="generated-preview">
        <!-- Здесь будет предпросмотр сгенерированных изображений -->
      </div>
    </div>

    <div class="mb-4">
      <div class="section-title">Загрузите аудио (опц., .mp3/.wav):</div>
      <input class="form-control" type="file" name="audio" accept=".mp3,.wav">
    </div>

    <div class="mb-4">
      <div class="section-title">Или найдите музыку по жанру:</div>
      <div class="input-group">
        <input type="text" class="form-control" id="music_query" placeholder="Например: jazz">
        <button class="btn btn-outline-secondary" type="button" onclick="searchMusic()">Найти</button>
      </div>
      <ul id="music_results" class="list-unstyled mt-3"></ul>
      <input type="hidden" name="selected_music_url" id="selected_music_url">
    </div>

    <div class="mb-4">
      <div class="section-title">Подписи и настройки:</div>
      <input class="form-control mb-2" type="text" name="caption" placeholder="Подпись (опц.)">
      <input class="form-control mb-2" type="text" name="name" value="my_video">
      <input class="form-control mb-2" type="number" name="logo_size" value="100">

      <label class="form-label">Логотип:</label>
      <input class="form-control mb-2" type="file" name="logo" accept=".jpg,.png">

      <label class="form-label">Режим подгонки изображения:</label>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="fit_mode" value="center" id="fit1">
        <label class="form-check-label" for="fit1">center</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="fit_mode" value="cover" id="fit2" checked>
        <label class="form-check-label" for="fit2">cover</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="fit_mode" value="blur" id="fit3">
        <label class="form-check-label" for="fit3">blur</label>
      </div>
    </div>

    <div class="d-grid mt-4">
      <button type="submit" class="btn btn-primary btn-lg">Сгенерировать видео</button>
    </div>
  </form>
</div>

<script>
  function searchMusic() {
    const query = document.getElementById("music_query").value;
    fetch(`/search_music?q=${encodeURIComponent(query)}`)
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById("music_results");
        container.innerHTML = "";
        data.forEach(track => {
          const li = document.createElement("li");
          li.className = "mb-3";
          li.innerHTML = `
            <strong>${track.name}</strong> — <em>${track.artist}</em><br>
            <audio controls src="${track.audio}" class="my-1"></audio><br>
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectMusic('${track.audio}')">Выбрать</button>
          `;
          container.appendChild(li);
        });
      });
  }

  function selectMusic(url) {
    document.getElementById("selected_music_url").value = url;
    alert("Музыка выбрана!");
  }

  function generateAIImages() {
    const prompt1 = document.getElementById("prompt1").value;
    const prompt2 = document.getElementById("prompt2").value;
    fetch("/", {
      method: "POST",
      headers: {
        "X-Requested-With": "XMLHttpRequest",
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: `generate_ai=true&prompt1=${encodeURIComponent(prompt1)}&prompt2=${encodeURIComponent(prompt2)}`
    })
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("generated-preview");
      container.innerHTML = "";
      data.images.forEach((img, index) => {
        container.innerHTML += `
          <div class="ai-image-preview">
            <img src="/static/generated/${img}" alt="AI Image">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="use_generated[]" value="${img}" id="ai_img_${index}">
              <label class="form-check-label" for="ai_img_${index}">Добавить в видео</label>
            </div>
          </div>
        `;
      });
    });
  }
</script>

</body>
</html>
